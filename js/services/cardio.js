'use strict';

angular
.module('ecg.services')

.factory('Cardio', function(SplinePoints) {
  var time     = 0,
      timeStep = 1 / 400,
      spline   = new BSpline(SplinePoints, 2, true),
      x, y;

  setInterval(function() {
    var value = spline.calcAt(time);

    x = value[0];
    y = value[1];

    // calc next `t`
    time += timeStep;
    if(time > 1) {
      time -= 1;
    }
  }, 1000 / 200);

  return {
    get value() {
      return {
        x: x,
        y: y
      };
    }
  };
})

.factory('SplinePoints', function() {
  var points = [
    [
      -0.05833333333333335,
      0.05833333333333335
    ],
    [
      -0.01666666666666672,
      0.2250000000000001
    ],
    [
      0.125,
      0.1791666666666667
    ],
    [
      0.10416666666666674,
      0.04166666666666674
    ],
    [
      -0.008333333333333304,
      -0.01666666666666672
    ],
    [
      -0.19166666666666665,
      -0.029166666666666674
    ],
    [
      -0.17500000000000004,
      0.24583333333333335
    ],
    [
      0.2749999999999999,
      0.6541666666666666
    ],
    [
      1,
      0.8625
    ],
    [
      0.8458333333333334,
      0.4916666666666667
    ],
    [
      0.5791666666666666,
      0.1625000000000001
    ],
    [
      0.1708333333333334,
      -0.17083333333333328
    ],
    [
      -0.11250000000000004,
      0
    ],
    [
      0.18333333333333335,
      0.28333333333333344
    ],
    [
      0.40833333333333344,
      0.34166666666666656
    ],
    [
      0.35416666666666674,
      0.1333333333333333
    ],
    [
      0.1499999999999999,
      -0.04166666666666663
    ],
    [
      0,
      -0.025000000000000022
    ]
  ];
  return points;
});
